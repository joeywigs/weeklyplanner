<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MealFlow - Weekly Meal Planner</title>
  <meta name="description" content="A smart weekly meal planning and shopping app for busy families">
  <meta name="theme-color" content="#16a34a">
  <!-- <link rel="manifest" href="/manifest.json"> -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f3f4f6;
      min-height: 100vh;
      color: #1a1a1a;
    }

    /* ---- Login Page ---- */
    .login-bg {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 50%, #bbf7d0 100%);
      min-height: 100vh;
    }
    .container { max-width: 480px; margin: 0 auto; padding: 24px 16px; }
    .header { text-align: center; padding: 48px 0 32px; }
    .logo { font-size: 48px; margin-bottom: 8px; }
    .app-name { font-size: 36px; font-weight: 800; color: #15803d; letter-spacing: -1px; }
    .tagline { font-size: 16px; color: #4b5563; margin-top: 8px; }
    .feature-desc { font-size: 13px; color: #6b7280; margin-top: 2px; }
    .nav-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .nav-card {
      background: white; border-radius: 16px; padding: 24px 16px; text-align: center;
      color: inherit; box-shadow: 0 1px 3px rgba(0,0,0,0.08); cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .nav-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
    .nav-card .icon { font-size: 32px; margin-bottom: 8px; }
    .nav-card .label { font-size: 14px; font-weight: 600; color: #111; }
    .status-bar {
      margin-top: 40px; padding: 16px; background: white; border-radius: 12px;
      text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .status-bar .badge {
      display: inline-block; background: #dcfce7; color: #15803d;
      padding: 4px 12px; border-radius: 999px; font-size: 12px; font-weight: 600; margin-bottom: 8px;
    }
    .status-bar p { font-size: 13px; color: #6b7280; }

    /* ---- Pages ---- */
    .page { display: none; }
    .page.active { display: block; }

    /* ---- Top Bar ---- */
    .top-bar {
      background: white; border-bottom: 1px solid #e5e7eb; padding: 12px 16px;
      display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 40;
    }
    .top-bar-title { font-size: 18px; font-weight: 700; color: #111; }
    .top-bar-week { font-size: 13px; color: #6b7280; }

    /* ---- Plan the Week Button ---- */
    .plan-btn {
      display: block; width: 100%; padding: 14px; border: none; border-radius: 12px;
      font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s;
      font-family: inherit;
    }
    .plan-btn.ready {
      background: #16a34a; color: white;
    }
    .plan-btn.ready:hover { background: #15803d; }
    .plan-btn.planning {
      background: #fef9c3; color: #a16207; cursor: wait;
    }
    .plan-btn.complete {
      background: #dcfce7; color: #15803d; cursor: default;
    }

    /* ---- Weekly Grid ---- */
    .week-table { margin-top: 16px; }
    .day-row {
      background: white; border-radius: 12px; margin-bottom: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06); overflow: hidden;
    }
    .day-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; border-bottom: 1px solid #f3f4f6;
    }
    .day-label { font-weight: 700; font-size: 15px; color: #111; }
    .day-date { font-size: 12px; color: #9ca3af; }
    .day-columns {
      display: grid; grid-template-columns: 1fr 1fr; min-height: 72px;
    }
    .day-col {
      padding: 10px 16px; display: flex; flex-direction: column; justify-content: center;
    }
    .day-col:first-child { border-right: 1px solid #f3f4f6; }
    .col-label {
      font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
      color: #9ca3af; margin-bottom: 4px;
    }
    .event-item { margin-bottom: 6px; }
    .event-item:last-child { margin-bottom: 0; }
    .event-title { font-size: 13px; font-weight: 600; color: #374151; }
    .event-detail { font-size: 11px; color: #9ca3af; }
    .no-events { font-size: 13px; color: #d1d5db; font-style: italic; }

    /* Dinner column */
    .dinner-name { font-size: 14px; font-weight: 600; color: #111; }
    .dinner-meta { display: flex; gap: 8px; margin-top: 4px; align-items: center; }
    .dinner-prep { font-size: 11px; color: #6b7280; }
    .effort-dot {
      width: 8px; height: 8px; border-radius: 50%; display: inline-block;
    }
    .effort-dot.easy { background: #22c55e; }
    .effort-dot.medium { background: #eab308; }
    .effort-dot.hard { background: #ef4444; }
    .effort-label { font-size: 11px; color: #6b7280; }
    .dinner-empty {
      font-size: 13px; color: #d1d5db; font-style: italic;
    }
    .dinner-assigned {
      background: #f0fdf4; border-radius: 8px; padding: 8px; margin: -4px;
    }

    /* ---- Column Headers ---- */
    .col-headers {
      display: grid; grid-template-columns: 1fr 1fr;
      padding: 8px 16px; margin-top: 12px;
    }
    .col-headers span {
      font-size: 11px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.5px; color: #6b7280;
    }
    .col-headers span:last-child { padding-left: 16px; }

    /* ---- Back button ---- */
    .back-btn {
      display: inline-flex; align-items: center; gap: 6px;
      background: none; border: none; font-size: 14px; color: #16a34a;
      font-weight: 600; cursor: pointer; padding: 8px 0; margin-bottom: 16px;
    }

    /* ---- Page title ---- */
    .page-title { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: #111; }

    /* ---- Recipe List ---- */
    .search-bar {
      background: white; border-radius: 12px; padding: 12px 16px;
      display: flex; align-items: center; gap: 8px; margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .search-bar input { border: none; outline: none; flex: 1; font-size: 15px; font-family: inherit; }
    .recipe-card {
      background: white; border-radius: 12px; padding: 16px; margin-bottom: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .recipe-name { font-weight: 600; font-size: 15px; }
    .recipe-meta { display: flex; gap: 12px; margin-top: 6px; font-size: 12px; color: #9ca3af; }
    .effort-badge { padding: 2px 8px; border-radius: 999px; font-size: 11px; font-weight: 600; }
    .effort-easy { background: #dcfce7; color: #15803d; }
    .effort-medium { background: #fef9c3; color: #a16207; }
    .effort-hard { background: #fee2e2; color: #dc2626; }

    /* ---- Shopping List ---- */
    .category-section { margin-bottom: 20px; }
    .category-title {
      font-size: 13px; font-weight: 600; text-transform: uppercase;
      color: #6b7280; letter-spacing: 0.5px; margin-bottom: 8px;
    }
    .shopping-item {
      background: white; border-radius: 10px; padding: 12px 16px; margin-bottom: 4px;
      display: flex; align-items: center; gap: 12px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05); cursor: pointer; transition: opacity 0.15s;
    }
    .shopping-item.checked { opacity: 0.5; text-decoration: line-through; }
    .checkbox {
      width: 22px; height: 22px; border: 2px solid #d1d5db; border-radius: 6px;
      flex-shrink: 0; display: flex; align-items: center; justify-content: center;
      transition: all 0.15s; font-size: 13px;
    }
    .shopping-item.checked .checkbox { background: #16a34a; border-color: #16a34a; color: white; }
    .item-name { font-size: 14px; }
    .item-qty { font-size: 12px; color: #9ca3af; margin-left: auto; }
    .progress-bar { background: #e5e7eb; border-radius: 999px; height: 8px; margin-bottom: 20px; overflow: hidden; }
    .progress-fill { background: #16a34a; height: 100%; border-radius: 999px; transition: width 0.3s; }

    /* ---- Settings ---- */
    .feature-card {
      background: white; border-radius: 16px; padding: 20px; display: flex;
      align-items: center; gap: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .feature-icon { font-size: 32px; flex-shrink: 0; width: 48px; text-align: center; }
    .feature-title { font-size: 16px; font-weight: 600; color: #111; }

    /* ---- Bottom Nav ---- */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0; background: white;
      border-top: 1px solid #e5e7eb; display: flex; justify-content: space-around;
      padding: 8px 0 env(safe-area-inset-bottom, 8px); z-index: 50;
    }
    .nav-item {
      display: flex; flex-direction: column; align-items: center; gap: 2px;
      padding: 8px 16px; cursor: pointer; color: #9ca3af; background: none;
      border: none; font-family: inherit; transition: color 0.15s;
    }
    .nav-item.active { color: #16a34a; }
    .nav-item .nav-label { font-size: 11px; font-weight: 500; }
    .nav-item svg { width: 24px; height: 24px; }
  </style>
</head>
<body>

  <!-- ======== LOGIN PAGE ======== -->
  <div id="page-home" class="page active login-bg">
    <div class="container">
      <div class="header">
        <div class="logo">üçΩÔ∏è</div>
        <div class="app-name">MealFlow</div>
        <div class="tagline">Weekly meal planning made simple</div>
      </div>

      <div class="nav-grid" style="margin-top: 32px;">
        <div class="nav-card" onclick="showPage('plan')">
          <div class="icon">üìÖ</div>
          <div class="label">Meal Plan</div>
          <div class="feature-desc" style="margin-top:4px;">Plan around your calendar</div>
        </div>
        <div class="nav-card" onclick="showPage('recipes')">
          <div class="icon">üìñ</div>
          <div class="label">Recipes</div>
          <div class="feature-desc" style="margin-top:4px;">Browse your recipe library</div>
        </div>
        <div class="nav-card" onclick="showPage('shopping')">
          <div class="icon">üõí</div>
          <div class="label">Shopping</div>
          <div class="feature-desc" style="margin-top:4px;">Auto-generated grocery list</div>
        </div>
        <div class="nav-card" onclick="showPage('settings')">
          <div class="icon">‚öôÔ∏è</div>
          <div class="label">Settings</div>
          <div class="feature-desc" style="margin-top:4px;">Pantry staples &amp; preferences</div>
        </div>
      </div>

      <div class="status-bar">
        <div class="badge">Phase 1 MVP</div>
        <p>Built with Next.js, Cloudflare Workers, and D1</p>
      </div>
    </div>
  </div>

  <!-- ======== PLAN PAGE (Main App Home) ======== -->
  <div id="page-plan" class="page">
    <div class="top-bar">
      <div>
        <div class="top-bar-title">MealFlow</div>
        <div class="top-bar-week" id="week-range"></div>
      </div>
    </div>
    <div class="container" style="padding-bottom: 90px;">
      <!-- Plan the Week button -->
      <div style="margin-bottom: 8px; margin-top: 4px;">
        <button class="plan-btn ready" id="plan-btn" onclick="planTheWeek()">
          Plan the Week
        </button>
      </div>

      <!-- Column headers -->
      <div class="col-headers">
        <span>Calendar</span>
        <span>Dinner</span>
      </div>

      <!-- Week rows -->
      <div id="week-table" class="week-table"></div>
    </div>
  </div>

  <!-- ======== RECIPES PAGE ======== -->
  <div id="page-recipes" class="page">
    <div class="container" style="padding-bottom: 80px;">
      <button class="back-btn" onclick="showPage('home')">‚Üê Back</button>
      <div class="page-title">Recipes</div>
      <div class="search-bar">
        <span>üîç</span>
        <input type="text" placeholder="Search recipes..." oninput="filterRecipes(this.value)">
      </div>
      <div id="recipe-list"></div>
    </div>
  </div>

  <!-- ======== SHOPPING PAGE ======== -->
  <div id="page-shopping" class="page">
    <div class="container" style="padding-bottom: 80px;">
      <button class="back-btn" onclick="showPage('home')">‚Üê Back</button>
      <div class="page-title">Shopping List</div>
      <div class="progress-bar">
        <div class="progress-fill" id="shopping-progress" style="width: 0%"></div>
      </div>
      <div id="shopping-list"></div>
    </div>
  </div>

  <!-- ======== SETTINGS PAGE ======== -->
  <div id="page-settings" class="page">
    <div class="container" style="padding-bottom: 80px;">
      <button class="back-btn" onclick="showPage('home')">‚Üê Back</button>
      <div class="page-title">Settings</div>
      <div class="feature-card" style="margin-bottom: 12px;">
        <div class="feature-icon">üë§</div>
        <div>
          <div class="feature-title">Account</div>
          <div class="feature-desc">Google OAuth sign-in required for full access</div>
        </div>
      </div>
      <div class="feature-card" style="margin-bottom: 12px;">
        <div class="feature-icon">üè™</div>
        <div>
          <div class="feature-title">Pantry Staples</div>
          <div class="feature-desc">Salt, pepper, olive oil, butter, garlic, and 15 more</div>
        </div>
      </div>
      <div class="feature-card" style="margin-bottom: 12px;">
        <div class="feature-icon">üîÑ</div>
        <div>
          <div class="feature-title">Recurring Essentials</div>
          <div class="feature-desc">Items you buy every week regardless of meal plan</div>
        </div>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ü•ú</div>
        <div>
          <div class="feature-title">Tree Nut Safety</div>
          <div class="feature-desc">Enabled ‚Äî all recipes scanned automatically</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ======== BOTTOM NAV ======== -->
  <div class="bottom-nav" id="bottom-nav" style="display: none;">
    <button class="nav-item" onclick="showPage('plan')" data-page="plan">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      <span class="nav-label">Plan</span>
    </button>
    <button class="nav-item" onclick="showPage('recipes')" data-page="recipes">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
      <span class="nav-label">Recipes</span>
    </button>
    <button class="nav-item" onclick="showPage('shopping')" data-page="shopping">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/></svg>
      <span class="nav-label">Shopping</span>
    </button>
    <button class="nav-item" onclick="showPage('settings')" data-page="settings">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      <span class="nav-label">Settings</span>
    </button>
  </div>

  <script>
    // ---- Data ----
    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    const today = new Date();
    const monday = new Date(today);
    monday.setDate(today.getDate() - ((today.getDay() + 6) % 7));

    const calendarEvents = [
      [ // Monday
        { title: 'Team standup', where: 'Zoom', duration: '30 min' },
        { title: 'Dentist appt', where: 'Dr. Smith Office', duration: '1 hr' }
      ],
      [ // Tuesday
        { title: 'Soccer practice', where: 'City Park', duration: '1.5 hr' }
      ],
      [ // Wednesday
        { title: 'Work presentation', where: 'Office', duration: '2 hr' },
        { title: 'Piano lesson', where: 'Music Academy', duration: '45 min' },
        { title: 'Book club', where: 'Library', duration: '1.5 hr' }
      ],
      [ // Thursday
      ],
      [ // Friday
        { title: 'Date night', where: 'Downtown', duration: '3 hr' }
      ],
      [ // Saturday
        { title: 'Farmers market', where: 'Town Square', duration: '1 hr' }
      ],
      [ // Sunday
        { title: 'Brunch with family', where: 'Mom\'s house', duration: '2 hr' }
      ]
    ];

    const recipes = [
      { name: 'Chicken Stir Fry', effort: 'easy', time: '25 min', servings: 4 },
      { name: 'Pasta Carbonara', effort: 'easy', time: '20 min', servings: 2 },
      { name: 'Beef Tacos', effort: 'easy', time: '30 min', servings: 4 },
      { name: 'Salmon with Roasted Vegetables', effort: 'medium', time: '45 min', servings: 2 },
      { name: 'Homemade Pizza', effort: 'medium', time: '60 min', servings: 4 },
      { name: 'Thai Green Curry', effort: 'medium', time: '35 min', servings: 4 },
      { name: 'Beef Bourguignon', effort: 'hard', time: '180 min', servings: 6 },
      { name: 'Grilled Cheese and Tomato Soup', effort: 'easy', time: '15 min', servings: 2 },
      { name: 'Chicken Parmesan', effort: 'medium', time: '50 min', servings: 4 },
      { name: 'Shrimp Scampi', effort: 'easy', time: '20 min', servings: 2 },
    ];

    // Dinner assignments ‚Äî null means not yet planned
    const dinners = [null, null, null, null, null, null, null];

    // Smart meal suggestions based on how busy the evening is
    const easyMeals = recipes.filter(r => r.effort === 'easy');
    const mediumMeals = recipes.filter(r => r.effort === 'medium');
    const hardMeals = recipes.filter(r => r.effort === 'hard');

    let planState = 'ready'; // 'ready' | 'planning' | 'complete'

    const shoppingItems = {
      'Produce': [
        { name: 'Bell peppers', qty: '3', checked: false },
        { name: 'Broccoli', qty: '2 heads', checked: false },
        { name: 'Onions', qty: '4', checked: false },
        { name: 'Garlic', qty: '1 head', checked: true },
        { name: 'Limes', qty: '3', checked: false },
        { name: 'Cilantro', qty: '1 bunch', checked: false },
      ],
      'Meat and Seafood': [
        { name: 'Chicken breast', qty: '2 lbs', checked: false },
        { name: 'Ground beef', qty: '1.5 lbs', checked: false },
        { name: 'Bacon', qty: '8 oz', checked: true },
      ],
      'Dairy': [
        { name: 'Parmesan cheese', qty: '4 oz', checked: false },
        { name: 'Sour cream', qty: '8 oz', checked: false },
        { name: 'Eggs', qty: '1 dozen', checked: true },
      ],
      'Pantry': [
        { name: 'Soy sauce', qty: '1 bottle', checked: false },
        { name: 'Spaghetti', qty: '1 lb', checked: false },
        { name: 'Taco shells', qty: '12 ct', checked: false },
        { name: 'Tortillas', qty: '10 ct', checked: true },
      ],
    };

    // ---- Plan the Week ----
    function planTheWeek() {
      if (planState !== 'ready') return;

      const btn = document.getElementById('plan-btn');
      planState = 'planning';
      btn.className = 'plan-btn planning';
      btn.textContent = 'Planning...';

      // Simulate planning with a short delay, then assign meals
      setTimeout(function() {
        for (let i = 0; i < 7; i++) {
          const eventCount = calendarEvents[i].length;
          let pool;
          if (eventCount >= 3) {
            // Very busy ‚Äî pick easy / leftovers
            pool = easyMeals;
          } else if (eventCount >= 1) {
            // Somewhat busy ‚Äî easy or medium
            pool = easyMeals.concat(mediumMeals);
          } else {
            // Free evening ‚Äî any difficulty
            pool = recipes;
          }
          // Pick a random meal from the pool, avoid repeats
          let pick;
          let attempts = 0;
          do {
            pick = pool[Math.floor(Math.random() * pool.length)];
            attempts++;
          } while (dinners.includes(pick) && attempts < 20);
          dinners[i] = pick;
        }

        planState = 'complete';
        btn.className = 'plan-btn complete';
        btn.textContent = 'Planning Complete';
        renderWeek();
      }, 1200);
    }

    // ---- Render Week ----
    function renderWeek() {
      // Set week range in header
      const sun = new Date(monday);
      sun.setDate(monday.getDate() + 6);
      document.getElementById('week-range').textContent =
        monday.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ‚Äì ' +
        sun.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

      const table = document.getElementById('week-table');
      table.innerHTML = days.map(function(day, i) {
        const date = new Date(monday);
        date.setDate(monday.getDate() + i);
        const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const events = calendarEvents[i];
        const dinner = dinners[i];

        // Calendar events column
        let eventsHtml;
        if (events.length === 0) {
          eventsHtml = '<div class="no-events">No events</div>';
        } else {
          eventsHtml = events.map(function(e) {
            return '<div class="event-item">' +
              '<div class="event-title">' + e.title + '</div>' +
              '<div class="event-detail">' + e.where + ' ¬∑ ' + e.duration + '</div>' +
            '</div>';
          }).join('');
        }

        // Dinner column
        let dinnerHtml;
        if (dinner) {
          dinnerHtml =
            '<div class="dinner-assigned">' +
              '<div class="dinner-name">' + dinner.name + '</div>' +
              '<div class="dinner-meta">' +
                '<span class="dinner-prep">' + dinner.time + '</span>' +
                '<span class="effort-dot ' + dinner.effort + '"></span>' +
                '<span class="effort-label">' + dinner.effort + '</span>' +
              '</div>' +
            '</div>';
        } else {
          dinnerHtml = '<div class="dinner-empty">Not planned</div>';
        }

        return '<div class="day-row">' +
          '<div class="day-header">' +
            '<span class="day-label">' + day + '</span>' +
            '<span class="day-date">' + dateStr + '</span>' +
          '</div>' +
          '<div class="day-columns">' +
            '<div class="day-col">' + eventsHtml + '</div>' +
            '<div class="day-col">' + dinnerHtml + '</div>' +
          '</div>' +
        '</div>';
      }).join('');
    }

    // ---- Render Recipes ----
    function renderRecipes(filter) {
      var list = document.getElementById('recipe-list');
      var filtered = filter
        ? recipes.filter(function(r) { return r.name.toLowerCase().indexOf(filter.toLowerCase()) >= 0; })
        : recipes;
      list.innerHTML = filtered.map(function(r) {
        return '<div class="recipe-card">' +
          '<div class="recipe-name">' + r.name + '</div>' +
          '<div class="recipe-meta">' +
            '<span class="effort-badge effort-' + r.effort + '">' + r.effort + '</span>' +
            '<span>‚è± ' + r.time + '</span>' +
            '<span>üçΩ ' + r.servings + ' servings</span>' +
          '</div>' +
        '</div>';
      }).join('');
    }

    // ---- Render Shopping ----
    function renderShopping() {
      var list = document.getElementById('shopping-list');
      var html = '';
      var categories = Object.keys(shoppingItems);
      for (var c = 0; c < categories.length; c++) {
        var category = categories[c];
        var items = shoppingItems[category];
        html += '<div class="category-section">' +
          '<div class="category-title">' + category + '</div>';
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          html += '<div class="shopping-item ' + (item.checked ? 'checked' : '') + '" ' +
            'onclick="toggleItem(\'' + category.replace(/'/g, "\\'") + '\', ' + i + ')">' +
            '<div class="checkbox">' + (item.checked ? '‚úì' : '') + '</div>' +
            '<span class="item-name">' + item.name + '</span>' +
            '<span class="item-qty">' + item.qty + '</span>' +
          '</div>';
        }
        html += '</div>';
      }
      list.innerHTML = html;
      updateProgress();
    }

    function toggleItem(category, index) {
      shoppingItems[category][index].checked = !shoppingItems[category][index].checked;
      renderShopping();
    }

    function updateProgress() {
      var all = [];
      var categories = Object.keys(shoppingItems);
      for (var c = 0; c < categories.length; c++) {
        var items = shoppingItems[categories[c]];
        for (var i = 0; i < items.length; i++) { all.push(items[i]); }
      }
      var checked = all.filter(function(i) { return i.checked; }).length;
      var pct = Math.round((checked / all.length) * 100);
      document.getElementById('shopping-progress').style.width = pct + '%';
    }

    function filterRecipes(val) { renderRecipes(val); }

    // ---- Navigation ----
    function showPage(page) {
      var pages = document.querySelectorAll('.page');
      for (var i = 0; i < pages.length; i++) { pages[i].classList.remove('active'); }
      document.getElementById('page-' + page).classList.add('active');

      var nav = document.getElementById('bottom-nav');
      nav.style.display = (page === 'home') ? 'none' : 'flex';

      var items = document.querySelectorAll('.nav-item');
      for (var j = 0; j < items.length; j++) {
        if (items[j].dataset.page === page) {
          items[j].classList.add('active');
        } else {
          items[j].classList.remove('active');
        }
      }

      if (page === 'plan') renderWeek();
      if (page === 'recipes') renderRecipes();
      if (page === 'shopping') renderShopping();

      window.scrollTo(0, 0);
    }

    // ---- Initialize ----
    document.addEventListener('DOMContentLoaded', function() {
      showPage('home');
    });
  </script>
</body>
</html>
